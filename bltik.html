<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Bilibili 视频播放器（第三方API示范）</title>
  <link href="https://cdn.jsdelivr.net/npm/plyr@3.6.2/dist/plyr.css" rel="stylesheet" />
  <style>
    body { font-family: sans-serif; max-width: 640px; margin: 20px auto; }
    #playlist { margin: 10px 0; }
    button { margin: 5px; }
  </style>
</head>
<body>
  <h2>Bilibili 视频播放器（第三方API）</h2>
  <div id="playlist"></div>
  <video id="player" playsinline controls crossorigin></video>

  <script src="https://cdn.jsdelivr.net/npm/plyr@3.6.2/dist/plyr.polyfilled.js"></script>
  <script>
    const plyrPlayer = new Plyr("#player");

    // 示例 BV 号列表
    const bvList = [
      "BV1oKUPYNEPn",
      "BV1mK4y1L7k8",
    ];

    const playlistEl = document.getElementById("playlist");

    function createPlaylist() {
      playlistEl.innerHTML = "";
      bvList.forEach(bvid => {
        const btn = document.createElement("button");
        btn.textContent = bvid;
        btn.onclick = () => loadVideo(bvid);
        playlistEl.appendChild(btn);
      });
    }

    async function loadVideo(bvid) {
      try {
        // 第三方免费API接口示范
        // 这个接口有时会被官方封禁，建议换用稳定API或中转
        const apiViewUrl = `https://api.bilibili.com/x/web-interface/view?bvid=${bvid}`;

        // 获取视频详情
        const res = await fetch(apiViewUrl, {
          headers: {
            "Referer": "https://www.bilibili.com",
            "User-Agent": "Mozilla/5.0"
          }
        });
        if (!res.ok) throw new Error(`接口请求失败：${res.status}`);

        const data = await res.json();
        if (data.code !== 0) throw new Error(`API 返回错误：${data.message}`);

        // 注意：这里官方接口返回的视频详情没有直接播放URL
        // 我们直接用一个示例硬编码URL演示播放
        // 你需要自己找到真实播放地址或者用另一个第三方接口获取播放链接

        // 示例硬编码的有效播放链接（你可以替换）
        const testVideoUrl = "https://upos-sz-mirrorcos.bilivideo.com/upgcxcode/30/11/140187130/140187130-1-30080.m4s";

        // 播放示例链接
        plyrPlayer.source = {
          type: 'video',
          sources: [
            { src: testVideoUrl, type: 'video/mp4' }
          ]
        };

        alert(`视频标题: ${data.data.title}\n演示用固定播放地址，请替换为真实播放地址`);
      } catch (e) {
        alert("加载失败: " + e.message);
      }
    }

    createPlaylist();
  </script>
</body>
</html>
